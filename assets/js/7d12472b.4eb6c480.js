"use strict";(self.webpackChunkanalytics_sdk_extensions=self.webpackChunkanalytics_sdk_extensions||[]).push([[24],{9971:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"sdks/analytics-sdks/android/advanced-usage/android-analytics-geo-tracking","title":"Geo Location Tracking","description":"Geo Location Tracking","source":"@site/docs/sdks/analytics-sdks/android/advanced-usage/geo-tracking.md","sourceDirName":"sdks/analytics-sdks/android/advanced-usage","slug":"/analytics-sdk/android/android-geo-tracking","permalink":"/rakuten-analytics-public-docs/docs/analytics-sdk/android/android-geo-tracking","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"sidebar_position":13,"id":"android-analytics-geo-tracking","slug":"/analytics-sdk/android/android-geo-tracking","title":"Geo Location Tracking","added_version":"2.x","updated_version":"11.1.0","changelog":"./android-changelog"},"sidebar":"docSidebar","previous":{"title":"App User-Agent to WebView","permalink":"/rakuten-analytics-public-docs/docs/analytics-sdk/android/android-user-agent"},"next":{"title":"Error Callback","permalink":"/rakuten-analytics-public-docs/docs/analytics-sdk/android/android-error-callback"}}');var t=o(4848),a=o(8453);const s={sidebar_position:13,id:"android-analytics-geo-tracking",slug:"/analytics-sdk/android/android-geo-tracking",title:"Geo Location Tracking",added_version:"2.x",updated_version:"11.1.0",changelog:"./android-changelog"},c=void 0,r={},l=[{value:"Geo Location Tracking",id:"geo-location-tracking",level:2},{value:"1- Request location permissions",id:"1--request-location-permissions",level:3},{value:"2- Start Location Collection",id:"2--start-location-collection",level:3},{value:"Using Default Configuration",id:"using-default-configuration",level:4},{value:"Using Custom Configuration",id:"using-custom-configuration",level:4},{value:"Stop Location Collection",id:"stop-location-collection",level:3},{value:"Get Configuration",id:"get-configuration",level:3},{value:"Request Location",id:"request-location",level:3},{value:"Geo Location Tracker Limits",id:"geo-location-tracker-limits",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"geo-location-tracking",children:"Geo Location Tracking"}),"\n",(0,t.jsxs)(n.p,{children:["The SDK uses ",(0,t.jsx)(n.code,{children:"GeoManager"})," to actively track location events for different states of the app based on access level to location services."]}),"\n",(0,t.jsxs)(n.p,{children:["Whilst tracking for location events the ",(0,t.jsx)(n.code,{children:"GeoManager"})," captures location updates at regular intervals and/or on significant change in device's location when being used in background, or terminated state. Please refer to the ",(0,t.jsx)(n.a,{href:"https://developer.android.com/about/versions/oreo/background-location-limits#apis",children:"Background Location Limits documentation"}),". The ",(0,t.jsx)(n.code,{children:"GeoManager"})," spools the captured location updates using ",(0,t.jsx)(n.code,{children:"RatTracker"})," in a regular time interval which is the ",(0,t.jsx)(n.code,{children:"RatTracker"})," batching delay.\nTo enable this functionality,"]}),"\n",(0,t.jsx)(n.h3,{id:"1--request-location-permissions",children:"1- Request location permissions"}),"\n",(0,t.jsxs)(n.p,{children:["For location event updates when the app is being used in ",(0,t.jsx)(n.strong,{children:"foreground"}),", your app needs to request either the ",(0,t.jsx)(n.code,{children:"ACCESS_COARSE_LOCATION"})," permission or the ",(0,t.jsx)(n.code,{children:"ACCESS_FINE_LOCATION"})," permission, as shown in the following snippet:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<manifest ... >\n  \x3c!-- Always include this permission --\x3e\n  <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />\n\n  \x3c!-- Include only if your app benefits from precise location access. --\x3e\n  <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />\n</manifest>\n'})}),"\n",(0,t.jsxs)(n.p,{children:["For location event updates when the app is being used in ",(0,t.jsx)(n.strong,{children:"background"}),", if your app targets Android 10 (API level 29) and higher, you must declare the ",(0,t.jsx)(n.code,{children:"ACCESS_BACKGROUND_LOCATION"})," permission in your app's manifest in order to request background location access at runtime. On earlier versions of Android, when your app receives foreground location access, it automatically receives background location access as well."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<manifest ... >\n  \x3c!-- Required only when requesting background location access on\n       Android 10 (API level 29) and higher. --\x3e\n  <uses-permission android:name="android.permission.ACCESS_BACKGROUND_LOCATION" />\n</manifest>\n'})}),"\n",(0,t.jsx)(n.h3,{id:"2--start-location-collection",children:"2- Start Location Collection"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"GeoManager"})," is a shared singleton that comes with a default ",(0,t.jsx)(n.code,{children:"GeoConfiguration"})," to track location events. It also allows you to set a desired configuration for tracking location events."]}),"\n",(0,t.jsx)(n.p,{children:"Starts the process of location collection based on either the default configuration or a custom configuration."}),"\n",(0,t.jsx)(n.h4,{id:"using-default-configuration",children:"Using Default Configuration"}),"\n",(0,t.jsx)(n.p,{children:"To start the location collection process, use either the default configuration or a custom configuration, as shown below:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kotlin",children:"val configuration = Configuration.Builder(context).build()\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The default ",(0,t.jsx)(n.code,{children:"Configuration"})," object captures ",(0,t.jsx)(n.code,{children:".HIGH"})," accurate location updates from ",(0,t.jsx)(n.code,{children:"00:00"})," to ",(0,t.jsx)(n.code,{children:"23:59"})," at regular intervals of ",(0,t.jsx)(n.code,{children:"300 seconds"}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"using-custom-configuration",children:"Using Custom Configuration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kotlin",children:"val configuration = Configuration.Builder(context)\n            .setAccuracy(Accuracy.NO_POWER) // The accuracy you want to receive. The default is [Accuracy.High].\n            .setStartTime(GeoTime()) // Default is 00:00\n            .setEndTime(GeoTime(17u, 30u)) // Default is 23:59\n            .setCollectionTimeInterval(420) // Default is 300 seconds, and the range is 60~1800 seconds.\n            .build() // to create the custom configuration.\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Warning:"})," When creating a custom configuration, if any of the configuration properties do not meet the specified criteria, the default value for that property will be used:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"accuracy"})," should be a value specified in type ",(0,t.jsx)(n.code,{children:"Accuracy"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"startTime"})," should not be equal to or exceed ",(0,t.jsx)(n.code,{children:"endTime"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"collectionTimeInterval"})," should be in the range of ",(0,t.jsx)(n.code,{children:"60 to 1800"})," seconds."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Once the ",(0,t.jsx)(n.code,{children:"Configuration"})," is built, it will be saved in ",(0,t.jsx)(n.code,{children:"SharedPreference"}),". Next time you build it without changing the parameter, it will be the same as the last time you create it."]}),"\n",(0,t.jsx)(n.p,{children:"And then, start the location collection using your configuration as shown below:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kotlin",children:"GeoManager.instance().startLocationCollection(context, configuration)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"stop-location-collection",children:"Stop Location Collection"}),"\n",(0,t.jsx)(n.p,{children:"Stops any ongoing location collection process and deletes the custom configuration set."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kotlin",children:"GeoManager.instance().stopLocationCollection(context)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"get-configuration",children:"Get Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["Returns the configuration that was set on starting the location collection. If no configuration was set, it returns ",(0,t.jsx)(n.code,{children:"null"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kotlin",children:"GeoManager.instance().getConfiguration()\n"})}),"\n",(0,t.jsx)(n.h3,{id:"request-location",children:"Request Location"}),"\n",(0,t.jsx)(n.p,{children:"Request a one-time delivery of the user\u2019s current location."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kotlin",children:" // for example:\n GeoManager.instance().requestLocation(context, LocationCallback({\n           location -> // ...\n       }, {\n           exception ->  // ...\n       }))\n \n//or by using lambda function:\n  //1- create your function e.g.\n  fun getLocation(success: (response: Location?) -> Unit, failure: (exception: Exception?) -> Unit\n    ){\n        GeoManager.instance().requestLocation(context, LocationCallback (success, failure))\n    }\n \n  // 2- get the response\n  getLocation({\n       it?.accuracy // ...\n    },{\n       it?.message //...\n    })\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Requesting for a location update can include an optional ",(0,t.jsx)(n.code,{children:"ActionParameters"})," as shown below:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-kotlin",children:'val actionParameters = ActionParameters(\n                actionType = "ButtonClick",\n                actionLog = "Login page button click",\n                actionId = "123",\n                actionDuration = "3 seconds",\n                additionalLog = "SSO Login")\nGeoManager.instance().requestLocation(context, LocationCallback({}, {}), actionParameters)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"geo-location-tracker-limits",children:"Geo Location Tracker Limits"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Following an app update from an older version, the Geo Location Tracker will stop tracking location events until the next scheduled start time."}),"\n",(0,t.jsxs)(n.li,{children:["The GeoTracker configuration is stored in SharedPreferences. If the file becomes corrupted or an obfuscation issue occurs, the configuration in SharedPreferences will be reset to null. This precaution prevents location tracking using the default configuration. For more details, refer to ",(0,t.jsx)(n.a,{href:"https://jira.rakuten-it.com/jira/browse/CONRAT-37432",children:"CONRAT-37432"}),"."]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>c});var i=o(6540);const t={},a=i.createContext(t);function s(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);